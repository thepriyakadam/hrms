<div class="box">
 <div class="box-header">
   <h3 class="box-title">Employee Attendance</h3>
   <div class="pull-right">
    <%= link_to "Add Employee Attendance", new_employee_attendance_path, class: 'btn btn-primary' %> 
   </div>
 </div><!-- /.box-header -->
 <div class="box-body">
 <table id="example3" class="table table-bordered table-hover table-condensed">
 <thead>
    z<tr>
     <th>ID</th>
      <th>Employee Name</th>
      <% for i in 1..@day %>
        <td><%= i %></td>
      <%end%>
    </tr>
      </thead>
       <tbody>
       <% exist = {} %>
         <% @employees.each do |e| %>
           <tr>
             <th><%= e.employee.manual_employee_code %></th>
             <th><%= full_name(e.employee) %></th>

             <% start_date = @date.beginning_of_month %>
             <% end_date = @date.end_of_month %>

             <% start_date.step(end_date).each do |d| %>
               <% flag = 0 %>
               <% attendance_records = EmployeeAttendance.where("strftime('%m/%Y', day) = ? and employee_id = ?", @date.strftime('%m/%Y'), e.employee_id) %>

               <% attendance_records.each do |a| %>
                 <% if d == a.day %>
                   <% flag = 1 %>
                   <% exist[a.day] = a.present %>
                 <% end %>
               <% end %>

               <% leave_records = ParticularLeaveRecord.where("strftime('%m/%Y', leave_date) = ? and employee_id = ?", @date.strftime('%m/%Y'), e.id) %>

               <% leave_records.each do |l| %>
                 <% if d == l.leave_date and flag == 0 %>
                   <% flag = 1 %>
                   <% exist[l.leave_date] = "L" %>
                 <% end %>
               <% end %>

               <% holidays = Holiday.where("strftime('%m/%Y', holiday_date) = ?", @date.strftime('%m/%Y')) %>

               <% holidays.each do |h| %>
                 <% if d == h.holiday_date and flag == 0 %>
                   <% flag = 1 %>
                   <% exist[h.holiday_date] = "H" %>
                 <% end %>
               <% end %>

               <% if flag == 0 %>
                 <% exist[d] = "" %>
               <% end %>
             <% end %>

             <% sorted_exists = Hash[exist.sort] %>
             <% sorted_exists.each do |k,v|%>
               <td><%= v %></td>
             <%end%>
           </tr>
           <% exist.clear %>
         <%end%>
       </tbody>
     </table>
   </div>
 </div>