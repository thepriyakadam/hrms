<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">
  <Worksheet ss:Name="Sheet1">
    <Table>
      <Row>
        <Cell ss:Index="1"><Data ss:Type="String">ID </Data></Cell>
        <Cell ss:Index="2"><Data ss:Type="String">Employee Name </Data></Cell>
        <% for i in 1..@day %>
        <Cell ss:Index="3"><Data ss:Type="String"><%= i %></Data></Cell>
        <%end%>
      </Row>
      <% exist = {} %>
      <% @employees.each do |e| %>
      <Row>
          <Cell ss:Index="1"><Data ss:Type="String"><%= e.employee.manual_employee_code %> </Data></Cell>
          <Cell ss:Index="2"><Data ss:Type="String"><%= full_name(e.employee) %></Data></Cell>
          <% sorted_exists = calculate_attendance(@date, exist, e)%>
          <% sorted_exists.each do |k,v|%>
          <Cell ss:Index="3"><Data ss:Type="String"><%= v %></Data></Cell>
          <%end%>
          
      
    
    <% present_day = present_day_count(exist) %>
            <% holiday_in_month = holiday_in_month_count(exist) %>
            <% week_off_day = week_off_day_count(exist) %>

            <% # full_pay_leave = full_pay_leave_count(exist) %>
            <% # half_pay_leave = half_pay_leave_count(exist) %>

            <% # pay_leave = full_pay_leave + half_pay_leave %>

            <% # full_lwp_leave = full_lwp_leave_count(exist) %>
            <% # half_lwp_leave = half_lwp_leave_count(exist) %>

            <% # lwp_leave = full_lwp_leave + half_lwp_leave %>
            <% workingday = [] %>
            <% workingday = create_leave(@date, e) %>
            
            <% payable_day = present_day.to_f + holiday_in_month.to_f + week_off_day.to_f + workingday[2] %>

            <%= hidden_field_tag "attendances[]", e.id %>
            <%= hidden_field e.employee_id, 'employee_id', value: e.employee_id %>
            <%= hidden_field e.employee_id, 'month_name', value: @date.strftime("%B") %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>
            <%= hidden_field e.employee_id, 'day_in_month', value: count_day(@day,e.employee_id) %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>
            <%= hidden_field e.employee_id, 'present_day', value: present_day %>
            <%= hidden_field e.employee_id, 'total_leave', value: total_leave_count(exist) %>
            <%= hidden_field e.employee_id, 'nonpay_leave', value: workingday[3] %>
            <%= hidden_field e.employee_id, 'pay_leave', value: workingday[2] %>
            <%= hidden_field e.employee_id, 'holiday_in_month', value: holiday_in_month %>
            <%= hidden_field e.employee_id, 'week_off_day', value: week_off_day %>
            <%= hidden_field e.employee_id, 'absent_day', value: absent_day_count(exist) %>
            <%= hidden_field e.employee_id, 'payable_day', value: payable_day %>
            <% exist.clear %>
            </Row><!-- Row -->
            <% end %><!-- slip -->
            </Table>
  </Worksheet>
</Workbook>

