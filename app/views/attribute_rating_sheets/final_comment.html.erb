<div class="box box-default">
  <div class="box-header with-border">
    <h3 class="box-title">Employee Details</h3>
  </div>
  <div class="box-body">
    <table class="table table-bordered table-hover table-condensed">
      <thead>
        <tr>
          <th>Employee ID</th>
          <th>Name</th>
          <th>Age</th>
          <th>Department</th>
          <th>Date Of Joining</th>
          <th>Grade</th>
          <th>Current Designation</th> 
        </tr>
      </thead>
      <tbody>
        <% @attribute_rating_sheets.each do |a| %>
          <tr>
            <td><%= a.appraisee.manual_employee_code %></td> 
            <td><%= a.appraisee.first_name %></td>
            <td><%= Time.now.year-a.appraisee.date_of_birth.year %></td>
            <td><%= a.appraisee.department.name %></td>
            <td><%= @joining_detail.joining_date %></td>
            <td><%= @joining_detail.employee_grade.name %></td>
            <td><%= @joining_detail.employee_designation.name %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="row">
      <div class="col-sm-6">
        <div class="box-header with-border">
          <h3 class="box-title">Previous Experience</h3>
        </div>
        <table class="table table-bordered table-hover table-condensed">
          <thead>
            <tr>
              <th>Previous Company</th>
              <th>Designation</th>
              <th>Previous Exp.(Years)</th>
              <th>Previous CTC</th>
              <th>Current CTC</th>
            </tr>
          </thead>
          <tbody>
            <% @experiences.each do |e| %>
              <tr>
                <td><%= e.company_name %></td>
                <td><%= e.designation %></td>
                <td><%= e.no_of_year %></td>
                <td><%= e.ctc %></td>
                <td><%= @ctc %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="col-sm-6">
        <div class="box-header with-border">
          <h3 class="box-title">Qualification Details</h3>
        </div>
        <table class="table table-bordered table-hover table-condensed">
          <thead>
            <tr>
              <th>Degree</th>
              <th>Qualification</th>
              <th>Year Of Passing</th>
              <th>Marks(%)</th>
            </tr>
          </thead>
          <tbody>
            <% @qualifications.each do |q| %>
              <tr>
                <td><%= q.degree.name %></td>
                <td><%= q.year.name %>
                <td><%= q.marks %></td>
                <td><%= q.degree_type.name %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <%= bootstrap_form_for(:attribute_rating_sheet,url:{controller: "attribute_rating_sheets",action: "final_create",id: @employee.id}) do |f| %>
      <div class="box-header with-border">
        <h3 class="box-title">Attribute</h3>
      </div>
      <table class="table table-bordered table-hover table-condensed example3">
        <thead>
          <tr>
            <th>Attribute & Definition</th>
            <th>Weightage</th>
            <th>Appraisee Comment</th>
            <th>Appraisee Evaluation</th>
            <th>Appraiser Comment</th>
            <th>Appraiser Evaluation</th>
            <th>Reviewer Comment</th>
            <th>Reviewer Evaluation</th>
            <th>Final Comment</th>
            <th>Final Rating</th>
          </tr>
        </thead>
        <tbody>
          <% @attribute_rating_multiple_sheets.each do |a| %>
            <tr>
              <td><%= a.employee_attribute.attribute_master.name %></td>
              <td><%= a.employee_attribute.weightage %></td>
              <td><%= a.appraisee_comment %></td>
              <td><%= a.appraisee_rating.try(:code) %></td>
              <td><%= a.appraiser_comment %></td>
              <td><%= a.appraiser_rating.try(:code) %></td>
              <td><%= a.appraiser2_comment %></td>
              <td><%= a.appraiser2_rating.try(:code) %></td>
              <td><%= text_field_tag 'final_comment[]',"",class: "form-control" %></td>
              <td><%= select_tag 'final_rating_id[]',options_for_select(all_rating_type),{class: 'form-control',hide_label: true,include_blank: " Select Rating"} %></td> 
              <%= hidden_field_tag 'attribute_rating_sheet_id[]',{},value: a.id %>
              <%= hidden_field_tag :final_id_id, {},value: current_user.employee_id %> 
            </tr>
          <% end %>
        </tbody>
      </table>

      <% unless @attribute_rating_multiple_sheets.empty? %>
        <div class="row">
          <div class="col-sm-3">
            <div class="actions">
              <%= f.submit "Assign Rating" , class: "btn btn-primary btn-sm" %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>

    <%= bootstrap_form_for :attribute_rating_sheet,url:{action:'is_confirm_final',id: @employee.id} do |f| %>
      <div class="box-header with-border">
        <h3 class="box-title">Attribute</h3>
      </div>
      <table class="table table-bordered table-hover table-condensed example3">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" value="selectAll"></th>
            <th>Attribute & Definition</th>
            <th>Weightage</th>
            <th>Appraisee Comment</th>
            <th>Appraisee Evaluation</th>
            <th>Appraiser Comment</th>
            <th>Appraiser Evaluation</th>
            <th>Reviewer Comment</th>
            <th>Reviewer Evaluation</th>
            <th>Final Comment</th>
            <th>Final Rating</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% appraisee_rating_sum = 0 %>
          <% appraiser_rating_sum = 0 %>
          <% appraiser2_rating_sum = 0 %>
          <% final_rating_sum = 0 %>

          <% @attribute_rating_multi_sheets.each do |a| %>
            <tr>
              <td>
                <%= check_box_tag "attribute_rating_sheet_ids[]", a.id unless a.is_confirm_final%>
              </td>
              <td><%= a.employee_attribute.attribute_master.name %></td>
              <td><%= weightage = a.employee_attribute.weightage %></td>
              <td><%= a.appraisee_comment %></td>
              <td><%= appraisee_rating = a.appraisee_rating.try(:code) %></td>
              <td><%= a.appraiser_comment %></td>
              <td><%= appraiser_rating = a.appraiser_rating.try(:code) %></td>
              <td><%= a.appraiser2_comment %></td>
              <td><%= appraiser2_rating = a.appraiser2_rating.try(:code) %></td>
              <td><%= a.final_comment %></td>
              <td><%= final_rating = a.final_rating.try(:code) %></td>

              <% appraisee_rating_output = weightage * appraisee_rating.to_i / 100.to_f %>
              <% appraiser_rating_output = weightage * appraiser_rating.to_i / 100.to_f %>
              <% appraiser2_rating_output = weightage * appraiser2_rating.to_i / 100.to_f %>
              <% final_rating_output = weightage * final_rating.to_i / 100.to_f %>

              <% appraisee_rating_sum = appraisee_rating_sum + appraisee_rating_output %>
              <% appraiser_rating_sum = appraiser_rating_sum + appraiser_rating_output %>
              <% appraiser2_rating_sum = appraiser2_rating_sum + appraiser2_rating_output %>
              <% final_rating_sum = final_rating_sum + final_rating_output %>

              <td>
                <% if a.is_confirm_final %>
                  <small class="label label-info">Confirmed</small>
                <% else %>
                  <%= link_to '', modal_final_attribute_rating_sheets_path(a),class: 'btn btn-success btn-xs fa fa-edit', remote: true %>
                <% end %>
              </td>
              <%= hidden_field_tag 'goal_rating_sheet_id[]', {},value: a.id %> 
              <%= hidden_field_tag :final_id_id, {},value: current_user.employee_id %>           
            </tr> 
          <% end %>
        </tbody>
      </table>
      <h6>Appraisee Rating - <%= appraisee_rating_sum %></h6>
      <h6>Appraiser Rating - <%= appraiser_rating_sum %></h6>
      <h6>Reviewer Rating - <%= appraiser2_rating_sum %></h6>
      <h6>Final Rating - <%= appraiser2_rating_sum %></h6>
      <div class="row">
        <div class="col-sm-3">
          <div class="actions">
            <%= f.submit "Confirm", class: 'btn btn-primary btn-sm' %>
            <%= link_to 'Back', final_comment_goal_rating_sheets_path(@employee.id),class: 'btn btn-default btn-sm fa fa-arrow-left' %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div id="myModal" class="modal fade"></div>

<script type="text/javascript">
  $(function () {
    $('#selectAll').click(function() {
      if (this.checked) {
        $(':checkbox').each(function() {
          this.checked = true;                       
        });
      } 
      else {
        $(':checkbox').each(function() {
          this.checked = false;                        
        });
      } 
    });
  });

 $(document).ready(function() {
  $('.example3').DataTable( {
    "scrollY":        "200px",
    "scrollX":        "1500px",
    "scrollCollapse": true,
    "paging":         false,
    "searching": false
  });
});
</script>