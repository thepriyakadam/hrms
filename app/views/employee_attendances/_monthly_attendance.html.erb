<%= bootstrap_form_for :temp, url: {action: "create_attendance", month: @month, year: @year} do |f| %>
      <table class="table table-bordered table-hover table-condensed">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" value="selectAll"></th>
            <th>ID</th>
            <% for i in 1..@day %>
              <th><%= i %></th>
            <%end%>
          </tr>
        </thead>
        <tbody>
          <% exist = {} %>
          <% @employees.each do |e| %>
            <tr>
              <td><%= check_box_tag "employees[]", e.employee_id unless e.is_confirm %></td>
              <td><%= e.employee.manual_employee_code %></td>
              <% sorted_exists = calculate_attendance(@date, exist, e)%>
              <% sorted_exists.each do |k,v|%>
                <td><%= v %></td>
              <%end%>
            </tr> 
            <% present_day = present_day_count(exist) %>
            <% holiday_in_month = holiday_in_month_count(exist) %>
            <% week_off_day = week_off_day_count(exist) %>
            <% gate_pass = gate_pass_count(exist) %>
            <% cl_leave = cl_leave_count(exist) %>
            <% el_leave = el_leave_count(exist) %>
            <% esic_leave = esic_leave_count(exist) %>
            <% advance_leave = advance_leave_count(exist) %>
            <% coff_leave = coff_leave_count(exist) %>
            <% lwp_leave = lwp_leave_count(exist) %>

            <% # full_pay_leave = full_pay_leave_count(exist) %>
            <% # half_pay_leave = half_pay_leave_count(exist) %>

            <% # pay_leave = full_pay_leave + half_pay_leave %>

            <% # full_lwp_leave = full_lwp_leave_count(exist) %>
            <% # half_lwp_leave = half_lwp_leave_count(exist) %>

            <% # lwp_leave = full_lwp_leave + half_lwp_leave %>
            <% workingday = [] %>
            <% workingday = create_leave(@date, e) %>
              <% if e.employee.try(:joining_detail).try(:employee_category).try(:name) == 'Worker' %>
                <% payable_day = present_day.to_f + holiday_in_month.to_f + workingday[2] %>
              <% else %>
                <% payable_day = present_day.to_f + holiday_in_month.to_f + week_off_day.to_f + workingday[2] %>
              <% end %>

            <%= hidden_field_tag "attendances[]", e.id %>
            <%= hidden_field e.employee_id, 'employee_id', value: e.employee_id %>
            <%= hidden_field e.employee_id, 'month_name', value: @date.strftime("%B") %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>
            <%= hidden_field e.employee_id, 'day_in_month', value: count_day(@day,e.employee_id) %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>
            <%= hidden_field e.employee_id, 'present_day', value: present_day %>
            <%= hidden_field e.employee_id, 'total_leave', value: total_leave_count(exist) %>
            <%= hidden_field e.employee_id, 'advance_leave', value: advance_leave %>
            <%= hidden_field e.employee_id, 'coff_leave', value: coff_leave %>
            <%= hidden_field e.employee_id, 'esic_leave', value: esic_leave %>
            <%= hidden_field e.employee_id, 'el_leave', value: el_leave %>
            <%= hidden_field e.employee_id, 'cl_leave', value: cl_leave %>

            <%= hidden_field e.employee_id, 'lwp_leave', value: lwp_leave %>
            <%= hidden_field e.employee_id, 'nonpay_leave', value: workingday[3] %>
            <%= hidden_field e.employee_id, 'pay_leave', value: workingday[2] %>
            <%= hidden_field e.employee_id, 'holiday_in_month', value: holiday_in_month %>
            <%= hidden_field e.employee_id, 'week_off_day', value: week_off_day %>
           
            <% if gate_pass <= 2 %>
              <%= hidden_field e.employee_id, 'absent_day', value: absent_day_count(exist) %>
            <% else %>
              <% @a = gate_pass.to_f - 2 %>
              <% @b = @a.to_f/2 %>
              <%= hidden_field e.employee_id, 'absent_day', value: absent_day_count(exist) + @b.to_f %>
            <% end %>

            <% if gate_pass <= 2 %>
              <%= hidden_field e.employee_id, 'present_day', value: present_day.to_f + gate_pass.to_f  + workingday[4] %>
            <% else %>
              <% @a = gate_pass.to_f - 2 %>
              <% @b = @a.to_f/2 %>
              <%= hidden_field e.employee_id, 'present_day', value: present_day.to_f + @b.to_f + 2  + workingday[4] %>
            <% end %>


            <% if gate_pass <= 2 %>
              <% if e.employee.try(:joining_detail).try(:employee_category).try(:name) == 'Worker' %>
                <%= hidden_field e.employee_id, 'payable_day', value: present_day.to_f + holiday_in_month.to_f + workingday[2] + gate_pass.to_f + workingday[4] %>
              <% else %>
                <%= hidden_field e.employee_id, 'payable_day', value: present_day.to_f + holiday_in_month.to_f + week_off_day.to_f + workingday[2] + gate_pass.to_f + workingday[4] %>
              <% end %>
            <% else %>
              <% @a = gate_pass.to_f - 2 %>
              <% @b = @a.to_f/2 %>
              <% if e.employee.try(:joining_detail).try(:employee_category).try(:name) == 'Worker' %>
                <%= hidden_field e.employee_id, 'payable_day', value: present_day.to_f + holiday_in_month.to_f + workingday[2] + @b.to_f + 2 + workingday[4] %>
              <% else %>
                <%= hidden_field e.employee_id, 'payable_day', value: present_day.to_f + holiday_in_month.to_f + week_off_day.to_f + workingday[2] + @b.to_f + 2 + workingday[4] %>
              <% end %>
            <% end %>

            <%= hidden_field e.employee_id, 'gatepass', value: gate_pass %>
            
            <% exist.clear %>
          <%end%>
        </tbody>
      </table>
      <%= f.submit "Confirm Workingdays", class: "btn btn-sm btn-primary" %>

      <%= link_to " Excel Report ",employee_attendance_excel_report_employee_attendances_path(month: params[:employee_attendance][:month], year: params[:employee_attendance][:year], format: "xls"), class: "btn btn-xl btn-success fa fa-print" %>

      <%= link_to " Print Attendance Slip ",employee_attendance_pdf_report_employee_attendances_path(month: params[:employee_attendance][:month], year: params[:employee_attendance][:year], format: "pdf"), class: "btn btn-xl btn-info fa fa-print", :target => "_blank" %>
    <% end %>
  <!-- </div>
</div> -->

<script type="text/javascript">
  $('#selectAll').click(function() {
    if (this.checked) {
      $(':checkbox').each(function() {
        this.checked = true;
      });
    }
    else {
      $(':checkbox').each(function() {
        this.checked = false;
      });
    }
  });
</script>