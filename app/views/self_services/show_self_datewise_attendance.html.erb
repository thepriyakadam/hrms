<div class="box">
  <div class="box-header">
    <h6 class="box-title">Attendance</h6>
  </div><!-- /.box-header -->
  <div class="box-body">
    <table id="example1" class="table table-bordered table-hover table-condensed">
    <% i = 0%>
      <thead>
      <tr>
          <td colspan="8"><center> 
            <% if current_user.try(:employee).try(:company_location).try(:company).try(:company_logo) == nil %>
            <% else %>
              <center> <%= image_tag current_user.try(:employee).try(:company_location).try(:company).try(:company_logo).url, :size => "100x80" %></center><br>
            <%end%> 
              <strong><%=current_user.try(:employee).try(:company_location).try(:company).try(:description)%></strong> <br> <%= current_user.try(:employee).try(:company_location).try(:company).try(:address)%> <br>
              
              </center>
          </td>
        </tr>
        <tr><th colspan="8"><center> Employee Attendance Report : <%= @from.to_date %> To <%= @to.to_date %></center></th></tr>
      <tr>
        <td>ID : <%= current_user.employee.manual_employee_code %></td>
        <td colspan="2">Employee : <%= full_name(current_user.employee) %></td>
        <td colspan="5">Department : <%= current_user.employee.company_location.try(:name) %> - <%= current_user.employee.try(:joining_detail).try(:cost_center).try(:name) %> - <%= current_user.employee.try(:department).try(:name) %> <%= current_user.employee.try(:sub_department).try(:name) %></td>
      </tr>
        <tr>
          <th>Sr.No.</th>
          <th>Date</th>
          <th>Day</th>
          <th>In Time</th>
          <th>Out Time</th>
          <th>Working Hrs.</th>
          <% if @company_time.present? %>
            <th>Late Mark</th>
          <% end %>
          <th>Present</th>
        </tr>
      </thead>
      <tbody>
        <% @employee_attendances.each do |employee_attendance| %>
          <tr>
            <td><%= i = i + 1 %></td>
            <td><%= employee_attendance.try(:day) %></td>
            <th><%= employee_attendance.try(:day).strftime("%A") %></th>
            <td><%= employee_attendance.try(:in_time) %></td>
            <td><%= employee_attendance.try(:out_time) %></td>
            <td><%= employee_attendance.try(:working_hrs) %></td>
            <% if @company_time.present? %>
              <% if employee_attendance.try(:holiday_id).present? || employee_attendance.try(:employee_week_off_id).present?  || employee_attendance.try(:on_duty_request_id).present? || employee_attendance.try(:employee_leav_request_id).present? %>
                <% if employee_attendance.try(:in_time).present? %>
                  <% time = Time.at(employee_attendance.try(:in_time)).utc.strftime("%H:%M") %>
                  <% exact_in_time = "08:30".to_time.strftime("%H:%M") %>
                  <% c_time = @company_time.to_time.strftime("%H:%M") %>

                  <% if (exact_in_time..@company_time).include?(time) %>
                    <td class="danger"><%= employee_attendance.try(:in_time) %></td>
                  <% else %>
                    <td></td>
                  <% end %>
                <% else %>
                  <td></td>
                <% end %>
              <% else %>
                <td></td>
              <% end %>
            <% end %> 
            <td><%= employee_attendance.try(:present) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <br>
    <%= link_to 'Back',employee_attendance_self_services_path,class: 'btn btn-default btn-sm fa fa-arrow-left'%>

     <%= link_to " Excel Report ",self_service_datewise_attendance_employee_attendances_path(:employee => {:from => params[:employee][:from],:to => params[:employee][:to],:employee_id => params[:employee][:employee_id]}, format: "xls"), class: "btn btn-xl btn-success fa fa-print" %>
 
     <%= link_to " Print Report ",self_service_datewise_attendance_employee_attendances_path(:employee => {:from => params[:employee][:from],:to =>  params[:employee][:to],:employee_id => params[:employee][:employee_id]},format: "pdf"), class: "btn btn-xl btn-info fa fa-print", :target => "_blank" %> 


  </div>
</div>