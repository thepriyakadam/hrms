<div class="box box-default">
  <div class="box-header with-border">
    <h3 class="box-title">Employee Annual Salary Master</h3>
    <div class="box-tools pull-right">
      <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
      <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
    </div>
  </div><!-- /.box-header -->
	<div class="box-body">
		<%= bootstrap_form_for :employee_annual_salary_data do |f| %>
			<div class="row">
				<div class="col-sm-6">
					<% @addected_salary_components.each do |item| %>
						<div class="row">
							<div class="col-sm-5">
								<label><%= item.name %></label>
								<%= f.text_field item.id, hide_label: true %>
							</div>
							<div class="col-sm-5">
								<% unless item.parent_id.nil? %>
									<label>% for <%= item.name %></label>
									<%= text_field_tag "percentage[]","",class: "form-control", id: "employee_annual_salary_data_percentage_#{item.id}" %>
								<% end %>
							</div>
						</div>
					<% end %>
				</div>
				<div class="col-sm-6">
					<% @deducted_salary_components.each do |item| %>
						<div class="row">
							<div class="col-sm-5">
								<label><%= item.name %></label>
								<%= f.text_field item.id, hide_label: true %>
							</div>
							<div class="col-sm-5">
								<% unless item.parent_id.nil? %>
									<label>% for <%= item.name %></label>
									<%= text_field_tag "percentage[]","",class: "form-control", id: "employee_annual_salary_data_percentage_#{item.id}" %>
								<% end %>	
							</div>
						</div>
					<% end %>
				</div>
			</div>
					<label>Select Employees</label>
					<table id="example2" class="table table-bordered table-hover">
				    <thead>
				      <tr>
					      <th>
					      	<input type="checkbox" id="selectAll" value="selectAll">
					      </th>
					      <th>Employee ID</th>
					      <th>Employee Name</th>
					      <th>Designation</th>
				      </tr>
					  </thead>
					  <tbody>
					    <% @employees.each do |employee| %>
					      <tr>
					        <td><%= check_box_tag "employee_ids[]", employee.id %></td>
					        <td><%= employee.manual_employee_code %></td>
					        <td><%= employee.first_name+' '+employee.last_name %></td>
					        <td><%= employee.joining_detail.try(:employee_designation).try(:name) %></td>
					      </tr>
					     <% end %>
				    </tbody>
			  	</table>
			

			<%= f.button "Create Employee Salary", class: "btn btn-primary", data: {disable_with: "<i class='fa fa-circle-o-notch fa-spin'></i> Wait..."} %>
		<% end %>
	</div><!-- /.box-body -->
  <div class="box-footer">
    Visit <a href="https://indiba.in/">www.indiba.in</a> for more Information about the HRMSONE.
  </div>
</div><!-- /.box -->

<script type="text/javascript">
	$('#selectAll').click(function() {
    if (this.checked) {
      $(':checkbox').each(function() {
        this.checked = true;                        
      });
    } 
    else {
      $(':checkbox').each(function() {
        this.checked = false;                        
      });
    }
  });

  <% @addected_salary_components.each do |item| %>
  
		$(function(){
		  $('#employee_annual_salary_data_percentage_<%=item.id%>').on('input', function() {
	      calculate();
	    });

	    $('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').on('input', function() {
	      calculate();
	    });

	    $('#employee_annual_salary_data_<%= item.try(:id) %>').on('input', function() {
	      calculate_percentage();
	    });

	    function calculate(){
	      var amount = parseInt($('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').val()); 
	      var percent = parseInt($('#employee_annual_salary_data_percentage_<%=item.id%>').val());
	      var perc="";
	      if(isNaN(amount) || isNaN(percent)){
	        perc=" ";
	      }
	      else {
	        perc = ((amount*percent) / 100).toFixed(2);
	      }
	      $('#employee_annual_salary_data_<%= item.try(:id) %>').val(perc);
	    }

	    function calculate_percentage(){
	      var basic_amount = parseInt($('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').val()); 
	      var input_amount = parseInt($('#employee_annual_salary_data_<%= item.try(:id) %>').val());
	      var perc="";
	      if(isNaN(basic_amount) || isNaN(input_amount)){
	        percent=" ";
	      }
	      else {
	        percent = ((input_amount/basic_amount) * 100).toFixed(2);
	      }
	      $('#employee_annual_salary_data_percentage_<%=item.id%>').val(percent);
	    }
		});
	<% end %>
	<% @deducted_salary_components.each do |item| %>
  
		$(function(){
		  $('#employee_annual_salary_data_percentage_<%=item.id%>').on('input', function() {
	      calculate();
	    });

	    $('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').on('input', function() {
	      calculate();
	    });

	    function calculate(){
	      var amount = parseInt($('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').val()); 
	      var percent = parseInt($('#employee_annual_salary_data_percentage_<%=item.id%>').val());
	      var perc="";
	      if(isNaN(amount) || isNaN(percent)){
	        perc=" ";
	      }
	      else {
	        perc = ((amount*percent) / 100).toFixed(2);
	      }
	      $('#employee_annual_salary_data_<%= item.try(:id) %>').val(perc);
	    }

	    function calculate_percentage(){
	      var basic_amount = parseInt($('#employee_annual_salary_data_<%= item.try(:parent).try(:id) %>').val()); 
	      var input_amount = parseInt($('#employee_annual_salary_data_<%= item.try(:id) %>').val());
	      var perc="";
	      if(isNaN(basic_amount) || isNaN(input_amount)){
	        percent=" ";
	      }
	      else {
	        percent = ((input_amount/basic_amount) * 100).toFixed(2);
	      }
	      $('#employee_annual_salary_data_percentage_<%=item.id%>').val(percent);
	    }
		});
	<% end %>	
</script>