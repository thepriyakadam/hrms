<div class="box">
  <div class="box-header">
    <h3 class="box-title">Employee Attendance</h3>
    <div class="pull-right">
      <%= link_to "Add Employee Attendance", new_employee_attendance_path, class: 'btn btn-primary' %> 
    </div>
  </div><!-- /.box-header -->
  <div class="box-body">
    <%= bootstrap_form_for :temp, url: {action: "create_attendance"} do |f| %>
      <table class="table table-bordered table-hover table-condensed">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" value="selectAll"></th>
            <th>ID</th>
            <th>Employee Name</th>
            <th>Department</th>
            <% for i in 1..@day %>
              <th><%= i %></th>
            <%end%>
          </tr>
        </thead>
        <tbody>
          <% exist = {} %>
          <% @employees.each do |e| %>
            <tr>
              <td><%= check_box_tag "employees[]", e.employee_id %></td>
              <td><%= e.employee.manual_employee_code %></td>
              <td><%= full_name(e.employee) %></td>
              <td><%= e.employee.joining_detail.try(:department).try(:name) %></td>
              <% sorted_exists = calculate_attendance(@date, exist, e)%>
              <% sorted_exists.each do |k,v|%>
                <td><%= v %></td>
              <%end%>
            </tr>
            <%= hidden_field_tag "attendances[]", e.id %>
            <%= hidden_field e.employee_id, 'employee_id', value: e.employee_id %>
            <%= hidden_field e.employee_id, 'month_name', value: @date.strftime("%B") %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>
            <%= hidden_field e.employee_id, 'day_in_month', value: count_day(@day,e.employee_id) %>
            <%= hidden_field e.employee_id, 'year', value: @date.strftime("%Y") %>

            <%= hidden_field e.employee_id, 'present_day', value: present_day_count(exist) %>
            <%= hidden_field e.employee_id, 'total_leave', value: total_leave_count(exist) %>
            <%= hidden_field e.employee_id, 'holiday_in_month', value: holiday_in_month_count(exist) %>
            <%= hidden_field e.employee_id, 'week_off_day', value: week_of_day_count(exist) %>
            <%= hidden_field e.employee_id, 'absent_day', value: absent_day_count(exist) %>
            <%= hidden_field e.employee_id, 'payable_day', value: payable_day_count(exist) %>
            <% exist.clear %>
          <%end%>
        </tbody>
      </table>
      <%=f.submit%>
    <%end%>
  </div>
</div>

<script type="text/javascript">
  $('#selectAll').click(function() {
    if (this.checked) {
      $(':checkbox').each(function() {
        this.checked = true;                        
      });
    } 
    else {
      $(':checkbox').each(function() {
        this.checked = false;                        
      });
    } 
  });
</script>
